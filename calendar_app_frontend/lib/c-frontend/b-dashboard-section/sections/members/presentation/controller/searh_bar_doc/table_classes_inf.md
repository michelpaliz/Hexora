Got it—here’s the same table, now with a concrete step-by-step use case for each piece.

### What each class/widget does + a mini “how it’s used” walkthrough

| Name                        | File                                          | Type                         | What it’s for                                                                                | Step-by-step example (how it participates)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | Key props / methods                                                                               |
| --------------------------- | --------------------------------------------- | ---------------------------- | -------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------- |
| **GroupSearchController**   | `controllers/group_search_controller.dart`    | `ChangeNotifier`             | The brain. Holds `usersInGroup`, `userRoles`, `searchResults` and talks to `UserRepository`. | 1) Constructed by `Provider` with `currentUser`, `group`, `userRepository`. 2) Seeds current user as `owner`. 3) (If editing) loads existing group users/roles. 4) `searchUser("ali")` is called → fetch + filter usernames → `searchResults` updates. 5) `addUser("@alex")` → fetch `User` → add to `usersInGroup`, role=`member`. 6) `changeRole("@mira","admin")` updates `userRoles`. 7) `removeUser("@alex")` removes from list and roles. 8) On “Done”, the screen reads `usersInGroup` + `userRoles` and returns them. | `searchUser`, `addUser`, `removeUser`, `changeRole`, `usersInGroup`, `userRoles`, `searchResults` |
| **AddUsersScreen**          | `add_users_flow/add_users_screen.dart`        | `StatelessWidget`            | Full-screen UI wrapper that wires the controller via `ChangeNotifierProvider`.               | 1) You `push()` this screen. 2) It creates the controller. 3) Renders `AddUsersBody`. 4) When user taps **Done**, it `Navigator.pop({users, roles})`.                                                                                                                                                                                                                                                                                                                                                                         | `currentUser`, `group`, `userRepository`                                                          |
| **_AddUsersScaffold**       | `add_users_flow/add_users_screen.dart`        | `StatelessWidget` (internal) | The actual `Scaffold` + AppBar actions.                                                      | 1) Shows AppBar with **Done**. 2) Hosts `AddUsersBody`. 3) Reads controller on **Done** and returns selections.                                                                                                                                                                                                                                                                                                                                                                                                               | —                                                                                                 |
| **AddUsersBody**            | `add_users_flow/add_users_screen.dart`        | `StatelessWidget`            | Reusable body (used by screen + dialog) containing Search, Results, and Selected list.       | 1) User types in search → body calls `ctrl.searchUser(q, context)`. 2) List shows `searchResults`. 3) Bottom panel shows selected users as chips with role dropdowns.                                                                                                                                                                                                                                                                                                                                                         | —                                                                                                 |
| **_EmptyState**             | `add_users_flow/add_users_screen.dart`        | `StatelessWidget` (internal) | Friendly prompt until there are results.                                                     | 1) Shows “Type at least 3 characters…” until `searchResults` has items.                                                                                                                                                                                                                                                                                                                                                                                                                                                       | —                                                                                                 |
| **showAddUsersDialog(...)** | `add_users_flow/add_users_dialog.dart`        | Function                     | Modal version of the same UI.                                                                | 1) You call `showAddUsersDialog(...)`. 2) It builds the same provider + `AddUsersBody`. 3) Clicking **Done** `pop`s `{users, roles}`.                                                                                                                                                                                                                                                                                                                                                                                         | `currentUser`, `group`, `userRepository`                                                          |
| **UserSearchBar**           | `add_users_flow/user_search_bar.dart`         | `StatefulWidget`             | Debounced search field with clear.                                                           | 1) User types “ali”. 2) After 250ms pause, triggers `onChanged("ali")` → controller `searchUser`. 3) Tap ✕ clears input → `onClear()` → controller `clearResults()`.                                                                                                                                                                                                                                                                                                                                                          | `onChanged`, `onClear`, `hintText`, `autofocus`                                                   |
| **UserSearchResultItem**    | `add_users_flow/user_search_result_item.dart` | `StatelessWidget`            | One search row with **Add** button.                                                          | 1) Row shows `@alex`. 2) User taps **Add** → calls `ctrl.addUser("alex", context)`. 3) Controller moves `@alex` to selected list and removes from results.                                                                                                                                                                                                                                                                                                                                                                    | `username`, `onAdd()`                                                                             |
| **SelectedUsersList**       | `add_users_flow/selected_users_list.dart`     | `StatelessWidget`            | Shows selected users as chips + role dropdown + remove.                                      | 1) Displays chips for `usersInGroup`. 2) User changes Mira’s role to **admin** → calls `ctrl.changeRole("@mira","admin")`. 3) User removes `@alex` → calls `ctrl.removeUser("@alex")`.                                                                                                                                                                                                                                                                                                                                        | `users`, `rolesByIdOrName`, `onRemove`, `onChangeRole`                                            |
| **_UserChip**               | `add_users_flow/selected_users_list.dart`     | `StatelessWidget` (internal) | The chip UI element.                                                                         | 1) Shows `@mira` + dropdown (`owner/admin/co-admin/member`) + remove (x). 2) Emits callbacks used by `SelectedUsersList`.                                                                                                                                                                                                                                                                                                                                                                                                     | `user`, `role`, `onRemove`, `onChangeRole`                                                        |

---

### One end-to-end example (quick narrative)

1. You open **AddUsersScreen** with `currentUser = you`, `group = null` (creating a new group).
2. **GroupSearchController** seeds you as `owner`.
3. You type “mir” → **UserSearchBar** debounces → `searchUser("mir")` → **searchResults** show `@mira`.
4. Tap **Add** on `@mira` → `addUser("mira")` → `usersInGroup = [you, mira]`, `userRoles[mira.id] = member`.
5. In **SelectedUsersList**, change `@mira` role to **admin** → `changeRole("mira","admin")`.
6. Type “alex” → add `@alex` → then decide to remove → `removeUser("alex")`.
7. Tap **Done** → screen returns `{ users: [you, mira], roles: { you.id: owner, mira.id: admin } }` → you persist to backend.

Want me to tailor the flow for your exact repository methods (e.g., different search call names or additional filters)?
